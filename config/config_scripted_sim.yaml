# ============================================================================
# Scripted Sim config
# ============================================================================

# === Subject Form ===========================================================
subinfo_fields:
  - name: subject_id
    type: int
    constraints:
      min: 101
      max: 999
      digits: 3

subinfo_mapping:
  subject_id: SIM编号
  Participant Information: 模拟信息
  registration_failed: 注册失败。
  registration_successful: 注册成功！
  invalid_input: 字段 {field} 输入无效


# === Display / Window =======================================================
window:
  size: [1280, 720]
  units: pix
  screen: 0
  bg_color: black
  fullscreen: false
  monitor_width_cm: 35.5
  monitor_distance_cm: 60


# === Task ===================================================================
task:
  task_name: oddball_mmn
  save_path: ./outputs/sim
  language: Chinese
  voice_name: zh-CN-YunyangNeural
  voice_enabled: false
  total_blocks: 1
  total_trials: 12
  trial_per_block: 12
  conditions: [standard, deviant, target]
  key_list: ["space"]
  delta: 1
  seed_mode: same_across_sub


# === Timing =================================================================
timing:
  fixation_duration: 0.2
  stimulus_duration: 0.4
  iti_duration: 0.2


# === Stimuli ================================================================
stimuli:
  fixation:
    type: text
    font: SimHei
    text: "+"
    color: white
    height: 48

  instruction_text:
    type: text
    font: SimHei
    text: |
      Oddball 任务（脚本模拟）

      屏幕会呈现三类刺激：标准（○）、偏差（△）、目标（★）\u3002
      仅在目标刺激（★）出现时按空格键。
      标准和偏差刺激出现时不要按键。

      请尽量保持注视中央并减少眨眼。
      按空格键开始。
    color: white
    height: 28
    wrapWidth: 980

  standard_stimulus:
    type: text
    font: SimHei
    text: "○"
    color: white
    height: 64

  deviant_stimulus:
    type: text
    font: SimHei
    text: "△"
    color: yellow
    height: 64

  target_stimulus:
    type: text
    font: SimHei
    text: "★"
    color: red
    height: 64

  block_break:
    type: text
    font: SimHei
    text: |
      脚本模拟区块结束
      第 {block_num}/{total_blocks} 区块结束
      总体正确率：{overall_accuracy:.1%}
      目标命中率：{target_hit_rate:.1%}
      非目标误报率：{false_alarm_rate:.1%}
      
      按空格键继续。
    color: white
    height: 24
    wrapWidth: 900

  good_bye:
    type: text
    font: SimHei
    text: |
      脚本模拟完成
      总体正确率：{overall_accuracy:.1%}
      目标命中率：{target_hit_rate:.1%}
      非目标误报率：{false_alarm_rate:.1%}
      
      按空格键退出。
    color: white
    height: 28
    wrapWidth: 900


# === Triggers ===============================================================
triggers:
  map:
    exp_onset: 1
    exp_end: 2
    block_onset: 10
    block_end: 11
    fixation_onset: 20
    standard_stimulus_onset: 40
    deviant_stimulus_onset: 41
    target_stimulus_onset: 42
    standard_key_press: 50
    deviant_key_press: 51
    target_key_press: 52
    standard_no_response: 60
    deviant_no_response: 61
    target_no_response: 62
    iti_onset: 80

  driver:
    type: serial_url
    url: loop://
    baudrate: 115200

  timing:
    post_delay_ms: 1

  policy:
    strict: false


# === Condition Generation ===================================================
condition_generation:
  weights:
    standard: 0.65
    deviant: 0.2
    target: 0.15
  order: random
  first_trial_label: standard

# === Sim ====================================================================
sim:
  output_dir: outputs/sim
  seed: 0
  participant_id: sim001
  session_id: sub-sim001_task-oddball_mmn_seed0
  log_path: outputs/sim/sub-sim001_task-oddball_mmn_seed0_sim_events.jsonl
  policy: warn
  default_rt_s: 0.2
  clamp_rt: false
  responder:
    type: scripted
    kwargs:
      key: space
      rt_s: 0.30
